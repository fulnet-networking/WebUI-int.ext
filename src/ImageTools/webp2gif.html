<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WebP to GIF Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.2/FileSaver.min.js"></script>
  </head>
  <body>
    <h1>WebP to GIF Converter</h1>
    <input type="file" id="image-upload" accept="image/*" />
    <button id="convert-button">Convert to GIF</button>
    <br />
    <canvas id="canvas"></canvas>
    <progress id="progress-bar" value="0" max="100"></progress>
    <script>
      var inputElement = document.getElementById("image-upload");
      var canvasElement = document.getElementById("canvas");
      var convertButton = document.getElementById("convert-button");
      var progressBar = document.getElementById("progress-bar");

      inputElement.addEventListener("change", function (event) {
        var file = event.target.files[0];
        var reader = new FileReader();
        reader.onload = function (event) {
          var image = new Image();
          image.onload = function () {
            canvasElement.width = image.width;
            canvasElement.height = image.height;
            canvasElement.getContext("2d").drawImage(image, 0, 0);
          };
          image.src = event.target.result;
        };
        reader.readAsDataURL(file);
      });

      convertButton.addEventListener("click", function () {
        var image = new Image();
        image.onload = function () {
          var gif = new GIF({
            workers: 2,
            quality: 10,
          });
          var frames = new AnimatedImage(image);
          frames.decode().then(function () {
            for (var i = 0; i < frames.length; i++) {
              gif.addFrame(frames.getImageData(i), {
                delay: frames.getDuration(i),
              });
            }
            gif.on("progress", function (progress) {
              // Update the progress bar value
              progressBar.value = Math.round(progress * 100);
            });
            gif.on("finished", function (blob) {
              var url = URL.createObjectURL(blob);
              var gifImage = new Image();
              gifImage.onload = function () {
                canvasElement.width = gifImage.width;
                canvasElement.height = gifImage.height;
                canvasElement.getContext("2d").drawImage(gifImage, 0, 0);
              };
              gifImage.src = url;
              saveAs(blob, "animation.gif");
              URL.revokeObjectURL(url);
            });
            gif.render();
          });
        };
        image.src = canvasElement.toDataURL("image/webp");
      });
    </script>
  </body>
</html>
